<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>스티븐 챗봇 - 마인크래프트 도우미</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    html, body {
      height: 100%;
    }

    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #f3f4f6;
      margin: 0; 
      padding: 0; 
      min-height: 100%;
      display: flex;
      justify-content: center;
    }
    
    .chat-container { 
      width: 100%;
      max-width: 460px; 
      margin: 0 auto; 
      display: flex; 
      flex-direction: column; 
      height: 100%;
      max-height: 100%;
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
      overflow: hidden;
    }
    
    .chat-header { 
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: white; 
      padding: 18px 20px;
      text-align: center;
      border-bottom: 3px solid rgba(255,255,255,0.1);
    }
    
    .chat-header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .chat-header p {
      margin: 5px 0 0 0;
      opacity: 0.8;
      font-size: 0.9rem;
    }
    
    .chat-area { 
      flex: 1; 
      overflow-y: auto; 
      padding: 16px; 
      display: flex; 
      flex-direction: column; 
      gap: 12px;
      background: #f8fafc;
    }
    
    .msg { 
      max-width: 80%; 
      padding: 12px 16px; 
      border-radius: 20px; 
      line-height: 1.5; 
      white-space: pre-wrap;
      word-wrap: break-word;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .user { 
      align-self: flex-end; 
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white; 
      border-bottom-right-radius: 5px;
    }
    
    .bot { 
      align-self: flex-start; 
      background: white; 
      border: 1px solid #e9ecef; 
      color: #2c3e50; 
      border-bottom-left-radius: 5px;
      border-left: 4px solid rgba(37, 99, 235, 0.4);
    }
    
    .composer { 
      display: flex; 
      gap: 8px; 
      padding: 12px 14px; 
      background: white; 
      border-top: 1px solid #e9ecef;
      align-items: center;
    }
    
    .composer input { 
      flex: 1; 
      padding: 10px 14px; 
      border: 1px solid #d8dee6; 
      border-radius: 22px; 
      font-size: 0.95rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background: #f8fafc;
    }
    
    .composer input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
      background: #fff;
    }
    
    .composer button { 
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px; 
      border: none; 
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: white; 
      border-radius: 999px; 
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-width: 96px;
      box-shadow: 0 4px 14px rgba(30, 64, 175, 0.25);
    }
    
    .composer button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(30, 64, 175, 0.3);
    }

    .composer button i {
      font-size: 1rem;
    }
    
    .welcome-message {
      text-align: center;
      padding: 30px 16px;
      color: #6c757d;
    }
    
    .welcome-message h3 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    
    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 16px;
    }
    
    .quick-action {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 20px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      flex: 1 1 45%;
      text-align: center;
    }
    
    .quick-action:hover {
      background: #3498db;
      color: white;
      transform: translateY(-2px);
    }
    
    .uuid-info {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border: 1px solid #dee2e6;
      border-radius: 10px;
      margin: 0 16px 12px;
      padding: 14px;
      border-left: 4px solid #28a745;
    }
    
    .typing-indicator {
      display: none;
      align-self: flex-start;
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 20px;
      padding: 12px 16px;
      border-bottom-left-radius: 5px;
      border-left: 4px solid #3498db;
    }
    
    .typing-dots {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #3498db;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-dots:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
    
    .wiki-link {
      color: #3498db;
      text-decoration: none;
      font-weight: 600;
    }
    
    .wiki-link:hover {
      text-decoration: underline;
    }

    @media (min-width: 768px) {
      body {
        align-items: center;
        padding: 24px 0;
      }

      .chat-container {
        max-width: 720px;
        height: 92vh;
      }

      .chat-area {
        padding: 24px;
        gap: 16px;
      }

      .composer {
        padding: 16px 20px;
        gap: 12px;
      }
    }

    body.embedded {
      background: transparent;
      display: block;
      height: 100%;
    }

    body.embedded .chat-container {
      max-width: none;
      height: 100%;
      border-radius: 16px;
      box-shadow: none;
      border: 1px solid #d1d5db;
    }

    body.embedded .chat-header {
      display: none;
    }

    body.embedded .chat-area {
      padding: 16px;
      background: #f8fafc;
    }

    body.embedded .composer {
      border-radius: 0 0 16px 16px;
      border-top: 1px solid #e5e7eb;
    }

    body.embedded .welcome-message {
      padding-top: 12px;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h1><i class="bi bi-robot me-2"></i>스티븐 챗봇</h1>
      <p>마인크래프트 전문 도우미 - 무엇이든 물어보세요!</p>
    </div>
    
    <div id="chat" class="chat-area">
      {% if not chat_history %}
        <div class="welcome-message">
          <h3><i class="bi bi-chat-dots me-2"></i>안녕하세요!</h3>
          <p>마인크래프트 관련 질문을 자유롭게 해보세요.</p>
          <p>광물, 인챈트, 양조, 몹, 도구 등에 대해 알려드릴 수 있습니다.</p>
          
          <div class="quick-actions">
            <div class="quick-action" onclick="sendQuickMessage('다이아몬드는 어떻게 찾나요?')">
              <i class="bi bi-gem me-1"></i>다이아몬드 찾기
            </div>
            <div class="quick-action" onclick="sendQuickMessage('인챈트는 어떻게 하나요?')">
              <i class="bi bi-magic me-1"></i>인챈트 방법
            </div>
            <div class="quick-action" onclick="sendQuickMessage('크리퍼는 어떻게 피하나요?')">
              <i class="bi bi-shield me-1"></i>크리퍼 대처법
            </div>
            <div class="quick-action" onclick="sendQuickMessage('양조는 어떻게 하나요?')">
              <i class="bi bi-flask me-1"></i>양조 방법
            </div>
          </div>
        </div>
      {% endif %}
      
      {% for m in chat_history %}
        {% if m.role == 'user' %}
          <div class="msg user">
            <i class="bi bi-person-fill me-2"></i>{{ m.text }}
          </div>
        {% else %}
          <div class="msg bot">
            <i class="bi bi-robot me-2"></i>{{ m.text|safe }}
          </div>
        {% endif %}
      {% endfor %}
      
      <div id="typing" class="typing-indicator">
        <i class="bi bi-robot me-2"></i>스티븐이 답변을 준비 중입니다
        <span class="typing-dots"></span>
        <span class="typing-dots"></span>
        <span class="typing-dots"></span>
      </div>
    </div>

    {% if uuid_info %}
      <div class="uuid-info">
        <strong><i class="bi bi-info-circle me-2"></i>UUID 정보</strong>: {{ uuid_info }}
      </div>
    {% endif %}

    <form id="form" class="composer" method="POST">
      {% csrf_token %}
      <input id="input" type="text" name="user_input" placeholder="마인크래프트 관련 질문을 입력하세요..." autocomplete="off">
      <button type="submit">
        <i class="bi bi-send me-1"></i>보내기
      </button>
    </form>
  </div>

  <script>
    if (window.self !== window.top) {
      document.body.classList.add('embedded');
    }

    const chat = document.getElementById('chat');
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const typing = document.getElementById('typing');
    
    function scrollBottom() { 
      chat.scrollTop = chat.scrollHeight; 
    }
    
    function showTyping() {
      typing.style.display = 'block';
      scrollBottom();
    }
    
    function hideTyping() {
      typing.style.display = 'none';
    }
    
    function sendQuickMessage(message) {
      input.value = message;
      form.submit();
    }
    
    scrollBottom();
    
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        showTyping();
        form.submit();
      }
    });
    
    form.addEventListener('submit', () => {
      showTyping();
    });
    
    // 자동 포커스
    input.focus();
  </script>
</body>
</html>
