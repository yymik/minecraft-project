<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì¸í¬ë˜í”„íŠ¸ ë°œì „ê³¼ì œ ë¶„ì„ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f3f6; }
        .card { margin-bottom: 1.5rem; border-radius: 0.5rem; }
        .progress-bar { transition: width .6s ease; }
        .scrollable-list { max-height: 250px; overflow-y: auto; border-radius: 0.3rem; }
        .card-header-main { background-color: #343a40; color: white; border-bottom: 3px solid #28a745; }

        .list-group-item-danger.text-dark {
            background-color: #f8d7da;
            color: #721c24 !important;
            font-weight: 500;
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #343a40;
            cursor: help; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ë„ì›€ë§ ì»¤ì„œë¡œ ë³€ê²½ */
        }
        .main-header {
            font-weight: 300;
        }
        .btn-group-custom {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        /* Collapse ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .accordion-button:not(.collapsed) {
            background-color: #e2e6ea;
            color: #1a1a1a;
        }
    </style>
</head>
<body class="py-5">
    <main class="container-fluid px-md-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">

                <div class="text-center mb-4">
                    <div class="btn-group-custom">
                        <a href="{% url 'save_analyzer:upload_page' %}" class="btn btn-dark shadow-sm">
                            ğŸ”„ ë¶„ì„ê¸° ë©”ì¸ìœ¼ë¡œ (ë‹¤ì‹œ ì‹œì‘)
                        </a>
                        <a href="/" class="btn btn-outline-dark shadow-sm">
                            ğŸ  Home í™”ë©´ìœ¼ë¡œ
                        </a>
                    </div>

                    <h1 class="display-5 main-header">ë§ˆì¸í¬ë˜í”„íŠ¸ ë°œì „ê³¼ì œ ë¶„ì„ê¸°</h1>
                    <p class="lead text-muted">ê²Œì„ ì €ì¥ í´ë”ì˜ <code>advancements</code>ì— ìˆëŠ” .json íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>

                <div class="accordion mb-4" id="advancementGuide">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                ğŸ” advancements íŒŒì¼ì„ ì°¾ëŠ” ë°©ë²• (Windows)
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#advancementGuide">
                            <div class="accordion-body bg-light">
                                <ol class="text-start">
                                    <li>**ìœˆë„ìš°í‚¤ (ì°½ë¬¸ ëª¨ì–‘ì˜ í‚¤) + R**ì„ ëˆŒëŸ¬ ì‹¤í–‰ ì°½ì„ ì—´ì–´ì¤ë‹ˆë‹¤.</li>
                                    <li>ì‹¤í–‰ ì°½ì— ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬(í´ë¦­ ì‹œ ë³µì‚¬ë¨)í•˜ì—¬ ë¶™ì—¬ë„£ê³  ì—”í„°ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.
                                        <div class="input-group mt-2 mb-2 w-50">
                                            <input type="text" class="form-control form-control-sm" value="%APPDATA%" id="appdata-path" readonly>
                                            <button class="btn btn-sm btn-outline-secondary" onclick="copyText('appdata-path')">ë³µì‚¬</button>
                                        </div>
                                    </li>
                                    <li>ë§¨ ìœ„ì— ìˆëŠ” **`.minecraft` í´ë”**ë¥¼ ë”ë¸” í´ë¦­í•˜ì—¬ ë§ˆì¸í¬ë˜í”„íŠ¸ í´ë”ë¥¼ ì—´ì–´ì¤ë‹ˆë‹¤.</li>
                                    <li>**`saves`** í´ë”ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.</li>
                                    <li>**ì›í•˜ëŠ” ë§µì˜ í´ë”**ì— ë“¤ì–´ê°‘ë‹ˆë‹¤. (ì˜ˆ: `My World`)</li>
                                    <li>**`advancements`** í´ë” ì•ˆì— ìˆëŠ” **`.json` íŒŒì¼**ì„ ì‚½ì…í•˜ë©´ ë©ë‹ˆë‹¤.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card shadow-lg">
                    <div class="card-body">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="input-group">
                                <input type="file" class="form-control" name="advancement_file" id="advancement_file" required accept=".json">
                                <button class="btn btn-success" type="submit">ë¶„ì„ ì‹œì‘!</button>
                            </div>
                        </form>
                    </div>
                </div>

                {% if error %}
                    <div class="alert alert-danger mt-4" role="alert">
                        <strong>ì˜¤ë¥˜:</strong> {{ error }}
                    </div>
                {% endif %}

                {% if analysis_results %}
                    <hr class="my-5">

                    <div class="card text-center mb-5 shadow-sm">
                        <div class="card-header card-header-main"><h3>ì¢…í•© ì§„í–‰ë¥ </h3></div>
                        <div class="card-body">
                            <p class="card-text fs-5">
                                ì´ <strong>{{ analysis_results.summary.total_count }}</strong>ê°œì˜ ë°œì „ê³¼ì œ ì¤‘ <strong>{{ analysis_results.summary.completed_count }}</strong>ê°œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.
                            </p>
                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: {{ analysis_results.summary.progress_percentage }}%;" aria-valuenow="{{ analysis_results.summary.progress_percentage }}" aria-valuemin="0" aria-valuemax="100">
                                    {{ analysis_results.summary.progress_percentage|floatformat:2 }}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 class="mb-4">ë¯¸ì™„ë£Œ ë„ì „ê³¼ì œ ìƒì„¸ ë¶„ì„</h2>
                    <div class="row">
                        {% for adv_key, adv in analysis_results.details.items %}
                        <div class="col-md-3 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title text-truncate"
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="top"
                                        title="{{ adv.name }}">
                                        {{ adv.name }}
                                    </h5>
                                    {% if adv.total != 'ì•Œ ìˆ˜ ì—†ìŒ' %}
                                    <p class="card-subtitle mb-2 text-muted">ì§„í–‰ ìƒí™©: <strong>{{ adv.count }}</strong> / {{ adv.total }}</p>
                                    {% else %}
                                    <p class="card-subtitle mb-2 text-muted">ì™„ë£Œ ê¸°ì¤€: {{ adv.count }}ê°œ</p>
                                    {% endif %}

                                    <div class="list-group scrollable-list mt-2 flex-grow-1">
                                    {% for item in adv.all_items %}
                                        {% if item.done %}
                                            <span class="list-group-item list-group-item-action list-group-item-success">âœ… {{ item.name }}</span>
                                        {% else %}
                                            <span class="list-group-item list-group-item-action list-group-item-danger text-dark">âŒ {{ item.name }}</span>
                                        {% endif %}
                                    {% endfor %}
                                    </div>
                                    <p class="mt-3 text-info small text-center">
                                        {% if adv.generic %}
                                        (ì „ì²´ í•­ëª© ê°œìˆ˜ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.)
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </main>
    <script>
        function copyText(elementId) {
            const copyText = document.getElementById(elementId);
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(copyText.value).then(() => {
                alert("ê²½ë¡œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: " + copyText.value);
            }).catch(err => {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
            });
        }

        // â­ íˆ´íŒ ë°ì´í„° ì •ì˜ (JavaScript) â­
        const ADVANCEMENT_DESCRIPTIONS = {
            "ëª¨í—˜ì˜ ì‹œê°„": "ì˜¤ë²„ì›”ë“œì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ì¢…ë¥˜ì˜ ìƒë¬¼êµ°ê³„(Biome)ë¥¼ íƒí—˜í•˜ì—¬, ëª¨ë“  ì§€í˜•ì„ ì •ë³µí•´ì•¼ í•©ë‹ˆë‹¤. ëì—†ëŠ” íƒí—˜ì´ í•„ìš”í•´ìš”!",
            "ê· í˜• ì¡íŒ ì‹ë‹¨": "ë§ˆì¸í¬ë˜í”„íŠ¸ ë‚´ì—ì„œ íšë“í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì¢…ë¥˜ì˜ ìŒì‹ì„ ìµœì†Œ í•œ ë²ˆì”© ì„­ì·¨í•´ì•¼ í•©ë‹ˆë‹¤. ë…ì´ ìˆëŠ” ìŒì‹ë„ ì˜ˆì™¸ëŠ” ì—†ì–´ìš”!",
            "ëª¬ìŠ¤í„° ë„ê°": "í‰í™”ë¡œìš´ ëª¹ì„ ì œì™¸í•œ ëª¨ë“  ì ëŒ€ì  ëª¹ì„ í•œ ë²ˆ ì´ìƒ ì²˜ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì§€ì˜¥ê³¼ ì—”ë“œì˜ ìœ„í—˜í•œ ì¡´ì¬ë“¤ë„ í¬í•¨ë©ë‹ˆë‹¤.",
            "ì§ì§€ì–´ì£¼ê¸°": "ëª¨ë“  ì¢…ë¥˜ì˜ êµë°° ê°€ëŠ¥í•œ ë™ë¬¼ë“¤(ë¼ì§€, ì†Œ, ë¬´ì‹œë£¸, ì•„í™€ë¡œí‹€, ì—¼ì†Œ ë“±)ì„ ì°¾ì•„ ì„±ê³µì ìœ¼ë¡œ êµë°°ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.",
            "í•˜ë‚˜ì˜ ëŠ‘ëŒ€ ë¬´ë¦¬": "ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ëª¨ë“  ì¢…ë¥˜ì˜ ëŠ‘ëŒ€ 9ì¢…(ì˜ˆ: ìˆ², ëˆˆ ë®ì¸, ê²€ì€ìƒ‰ ë“±)ì„ ê¸¸ë“¤ì´ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.",
            "ì™„ë²½í•œ ì¹´íƒˆë¡œê·¸": "ê½ƒì—ì„œ ì–»ëŠ” ì—¼ë£Œë¶€í„° í¬ê·€í•œ ê´‘ë¬¼ ì—¼ë£Œê¹Œì§€, ë§ˆì¸í¬ë˜í”„íŠ¸ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  16ê°€ì§€ ìƒ‰ì˜ ì—¼ë£Œë¥¼ ì œì‘í•˜ê±°ë‚˜ íšë“í•´ì•¼ í•©ë‹ˆë‹¤ã€‚",
            "ì§€ì˜¥ ì†ìœ¼ë¡œ": "ë„¤ë”(ì§€ì˜¥)ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ì¢…ë¥˜ì˜ ìƒë¬¼êµ°ê³„(Nether Wastes, Crimson Forest, Basalt Deltas ë“±)ë¥¼ íƒí—˜í•´ì•¼ í•©ë‹ˆë‹¤ã€‚"
        };

        // â­ íˆ´íŒ í™œì„±í™” ë¡œì§ (Hover ì¦‰ì‹œ í‘œì‹œ ì„¤ì •) â­
        document.addEventListener('DOMContentLoaded', function () {
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');

            [...tooltipTriggerList].map(tooltipTriggerEl => {
                const advName = tooltipTriggerEl.innerText.trim();
                const description = ADVANCEMENT_DESCRIPTIONS[advName] || "ë„ì „ê³¼ì œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";

                // data-bs-title ì†ì„±ì„ ì„¤ì •í•˜ì—¬ íˆ´íŒ ë‚´ìš©ì„ ì£¼ì…
                tooltipTriggerEl.setAttribute('data-bs-title', description);

                // íˆ´íŒ í™œì„±í™” (trigger: hover focus, delay: 0 ì„¤ì •)
                return new bootstrap.Tooltip(tooltipTriggerEl, {
                    trigger: 'hover focus', // ë§ˆìš°ìŠ¤ ì˜¤ë²„ ë° í¬ì»¤ìŠ¤ ì‹œ í™œì„±í™”
                    delay: 0 // ì§€ì—° ì‹œê°„ ì—†ì´ ì¦‰ì‹œ í‘œì‹œ
                });
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>